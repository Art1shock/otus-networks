- [ВЕРНУТЬСЯ К СПИСКУ ЛАБОРАТОРНЫХ РАБОТ](https://github.com/Art1shock/otus-networks/tree/main/labs)  
- [ПОСМОТРЕТЬ СХЕМУ СЕТИ](https://github.com/Art1shock/otus-networks/blob/main/labs/lab06/%D0%A1%D1%85%D0%B5%D0%BC%D0%B0_%D1%81%D0%B5%D1%82%D0%B8.md)  
- [ПОСМОТРЕТЬ КОНФИГ КОММУТАТОРА S1](https://github.com/Art1shock/otus-networks/blob/main/labs/lab06/config%20S1.md)  
- [ПОСМОТРЕТЬ КОНФИГ КОММУТАТОРА S2](https://github.com/Art1shock/otus-networks/blob/main/labs/lab06/config%20S2.md)  
- [ПОСМОТРЕТЬ КОНФИГ КОММУТАТОРА S3](https://github.com/Art1shock/otus-networks/blob/main/labs/lab06/config%20S3.md)

# Лабораторная работа. Развертывание коммутируемой сети с резервными каналами.

![](https://github.com/Art1shock/images/blob/main/%D0%A1%D0%BA%D1%80%D0%B8%D0%BD%D1%8B%20%D0%B4%D0%BB%D1%8F%20%D0%94%D0%97_7/Screenshot_6.png)

## Часть 1:	Создание сети и настройка основных параметров устройства
#### В части 1 вам предстоит настроить топологию сети и основные параметры маршрутизаторов.
### Шаг 1:	Создайте сеть согласно топологии.
#### Подключите устройства, как показано в топологии, и подсоедините необходимые кабели.
### Шаг 2:	Выполните инициализацию и перезагрузку коммутаторов.
### Шаг 3:	Настройте базовые параметры каждого коммутатора.
**a.	Отключите поиск DNS.  
b.	Присвойте имена устройствам в соответствии с топологией.  

![](https://github.com/Art1shock/images/blob/main/%D0%A1%D0%BA%D1%80%D0%B8%D0%BD%D1%8B%20%D0%B4%D0%BB%D1%8F%20%D0%94%D0%97_7/Screenshot_1.png)

c.	Назначьте class в качестве зашифрованного пароля доступа к привилегированному режиму.  
d.	Назначьте cisco в качестве паролей консоли и VTY и активируйте вход для консоли и VTY каналов.  

![](https://github.com/Art1shock/images/blob/main/%D0%A1%D0%BA%D1%80%D0%B8%D0%BD%D1%8B%20%D0%B4%D0%BB%D1%8F%20%D0%94%D0%97_7/Screenshot_2.png)

e.	Настройте logging synchronous для консольного канала.  
f.	Настройте баннерное сообщение дня (MOTD) для предупреждения пользователей о запрете несанкционированного доступа.  
g.	Задайте IP-адрес, указанный в таблице адресации для VLAN 1 на всех коммутаторах.  
h.	Скопируйте текущую конфигурацию в файл загрузочной конфигурации.**

![](https://github.com/Art1shock/images/blob/main/%D0%A1%D0%BA%D1%80%D0%B8%D0%BD%D1%8B%20%D0%B4%D0%BB%D1%8F%20%D0%94%D0%97_7/Screenshot_3.png)

### Шаг 4:	Проверьте связь.
#### Проверьте способность компьютеров обмениваться эхо-запросами.
#### Успешно ли выполняется эхо-запрос от коммутатора S1 на коммутатор S2?
#### Успешно ли выполняется эхо-запрос от коммутатора S1 на коммутатор S3?
#### Успешно ли выполняется эхо-запрос от коммутатора S2 на коммутатор S3?
#### Выполняйте отладку до тех пор, пока ответы на все вопросы не будут положительными.

Все эхо-запросы прошли успешно.

![](https://github.com/Art1shock/images/blob/main/%D0%A1%D0%BA%D1%80%D0%B8%D0%BD%D1%8B%20%D0%B4%D0%BB%D1%8F%20%D0%94%D0%97_7/Screenshot_4.png)

## Часть 2:	Определение корневого моста
### Шаг 1:	Отключите все порты на коммутаторах.

Все порты отключены:

![](https://github.com/Art1shock/images/blob/main/%D0%A1%D0%BA%D1%80%D0%B8%D0%BD%D1%8B%20%D0%B4%D0%BB%D1%8F%20%D0%94%D0%97_7/Screenshot_5.png)

### Шаг 2:	Настройте подключенные порты в качестве транковых.

![](https://github.com/Art1shock/images/blob/main/%D0%A1%D0%BA%D1%80%D0%B8%D0%BD%D1%8B%20%D0%B4%D0%BB%D1%8F%20%D0%94%D0%97_7/Screenshot_7.png)

### Шаг 3:	Включите порты F0/2 и F0/4 на всех коммутаторах.

Нужные порты включены:

![](https://github.com/Art1shock/images/blob/main/%D0%A1%D0%BA%D1%80%D0%B8%D0%BD%D1%8B%20%D0%B4%D0%BB%D1%8F%20%D0%94%D0%97_7/Screenshot_8.1.png)

### Шаг 4:	Отобразите данные протокола spanning-tree.

![](https://github.com/Art1shock/images/blob/main/%D0%A1%D0%BA%D1%80%D0%B8%D0%BD%D1%8B%20%D0%B4%D0%BB%D1%8F%20%D0%94%D0%97_7/Screenshot_9.1.png)

#### В схему ниже запишите роль и состояние (Sts) активных портов на каждом коммутаторе в топологии:

Записываю роли и статусы исходя из вывода команды **show spanning-tree**. Остальные роли и состояния дописываю исходя из логики работы протокола STP.

![](https://github.com/Art1shock/images/blob/main/%D0%A1%D0%BA%D1%80%D0%B8%D0%BD%D1%8B%20%D0%B4%D0%BB%D1%8F%20%D0%94%D0%97_7/Screenshot_10.2.png)

#### С учетом выходных данных, поступающих с коммутаторов, ответьте на следующие вопросы.
#### Какой коммутатор является корневым мостом? 

Коммутатор S2.

#### Почему этот коммутатор был выбран протоколом spanning-tree в качестве корневого моста?

Исходя из идентификатора BID, в который входит два поля: приоритет и MAC-адрес. Но так как значение приоритета у всех коммутаторов по умолчанию 32 769, то выбирается корневой мост с самым низким значением MAC-адреса (в данном случае это коммутатор S2).

#### Какие порты на коммутаторе являются корневыми портами?

Корневые порты есть на коммутаторах S1 (Fa0/1) и S3 (Fa0/2).

#### Какие порты на коммутаторе являются назначенными портами?

На S2 все порты являются назначенными.

#### Какой порт отображается в качестве альтернативного и в настоящее время заблокирован?

Исходя из скриншота с выводом команды **show spanning-tree** альтернативный порт находится на коммутаторе S1 (Fa0/4).

#### Почему протокол spanning-tree выбрал этот порт в качестве невыделенного (заблокированного) порта?

Альтернативным портом будет порт находящийся на коммутаторе с самым высоким BID (вообще сравнивается по стоимости пути до корневого моста, но в данном случае стоимости одинаковые (по 19), поэтому сравнивается по BID) и при этом другая сторона не должна являться корневым портом, иначе получится, что путь до корневого моста будет заблокирован. В схеме выше где вписывались роли и состояния портов можно легко заметить, что напротив корневых портов (Root) находятся назначенные порты (Desg). В остальных случаях напротив назначенных портов стоят альтернативные порты (Altn) и причем они заблокированы (BLK), чтобы избежать петли.

Постараюсь показать это на изображении:

![](https://github.com/Art1shock/images/blob/main/%D0%A1%D0%BA%D1%80%D0%B8%D0%BD%D1%8B%20%D0%B4%D0%BB%D1%8F%20%D0%94%D0%97_7/Screenshot_12.png)

Назначенным будет порт на том коммутаторе, где наименьшая стоимость пути до корневого моста (наоборот для альтернативного порта). Видно, что стоимость путей одинакова, поэтому и сравниваем по BID (он включает в себя приоритет и MAC-адрес моста), но так как приоритеты не менялись (они везде одинаковые), то сравнивается по MAC-адресу.

## Часть 3:	Наблюдение за процессом выбора протоколом STP порта, исходя из стоимости портов
### Шаг 1:	Определите коммутатор с заблокированным портом

![](https://github.com/Art1shock/images/blob/main/%D0%A1%D0%BA%D1%80%D0%B8%D0%BD%D1%8B%20%D0%B4%D0%BB%D1%8F%20%D0%94%D0%97_7/Screenshot_9.1.png)

Коммутатор с заблокированным портом будет S1.

### Шаг 2:	Измените стоимость порта.
**Помимо заблокированного порта, единственным активным портом на этом коммутаторе является порт, выделенный в качестве порта корневого моста. Уменьшите стоимость этого порта корневого моста до 18, выполнив команду spanning-tree cost 18 режима конфигурации интерфейса.**

![](https://github.com/Art1shock/images/blob/main/%D0%A1%D0%BA%D1%80%D0%B8%D0%BD%D1%8B%20%D0%B4%D0%BB%D1%8F%20%D0%94%D0%97_7/Screenshot_11.png)

### Шаг 3:	Просмотрите изменения протокола spanning-tree.

Теперь порт на коммутаторе S1 (Fa0/4) стал назначенным.

![](https://github.com/Art1shock/images/blob/main/%D0%A1%D0%BA%D1%80%D0%B8%D0%BD%D1%8B%20%D0%B4%D0%BB%D1%8F%20%D0%94%D0%97_7/Screenshot_.png)

**Почему протокол spanning-tree заменяет ранее заблокированный порт на назначенный порт и блокирует порт, который был назначенным портом на другом коммутаторе?**

Потому что стоимость пути до корневого моста изменилась в меньшую сторону. Назначенным портом будет порт на том коммутаторе, где стоимость пути до корневого моста будет наименьшей.

![](https://github.com/Art1shock/images/blob/main/%D0%A1%D0%BA%D1%80%D0%B8%D0%BD%D1%8B%20%D0%B4%D0%BB%D1%8F%20%D0%94%D0%97_7/Screenshot_13.png)

Соответственно роли и статусы портов Fa0/4 (S1) и Fa0/4 (S3) поменяются местами.

**Шаг 4:	Удалите изменения стоимости порта.
a.	Выполните команду no spanning-tree cost 18 режима конфигурации интерфейса, чтобы удалить запись стоимости, созданную ранее.  
S1(config)# interface f0/2  
S1(config-if)# no spanning-tree cost 18**

![](https://github.com/Art1shock/images/blob/main/%D0%A1%D0%BA%D1%80%D0%B8%D0%BD%D1%8B%20%D0%B4%D0%BB%D1%8F%20%D0%94%D0%97_7/Screenshot_14.png)


**b.	Повторно выполните команду show spanning-tree, чтобы подтвердить, что протокол STP сбросил порт на коммутаторе некорневого моста, вернув исходные настройки порта. Протоколу STP требуется примерно 30 секунд, чтобы завершить процесс перевода порта.**

Теперь все стало как прежде:

![](https://github.com/Art1shock/images/blob/main/%D0%A1%D0%BA%D1%80%D0%B8%D0%BD%D1%8B%20%D0%B4%D0%BB%D1%8F%20%D0%94%D0%97_7/Screenshot_17.png)

## Часть 4:	Наблюдение за процессом выбора протоколом STP порта, исходя из приоритета портов
**a.	Включите порты F0/1 и F0/3 на всех коммутаторах.
b.	Подождите 30 секунд, чтобы протокол STP завершил процесс перевода порта, после чего выполните команду show spanning-tree на коммутаторах некорневого моста. Обратите внимание, что порт корневого моста переместился на порт с меньшим номером, связанный с коммутатором корневого моста, и заблокировал предыдущий порт корневого моста.**

Нужные порты включены:

![](https://github.com/Art1shock/images/blob/main/%D0%A1%D0%BA%D1%80%D0%B8%D0%BD%D1%8B%20%D0%B4%D0%BB%D1%8F%20%D0%94%D0%97_7/Screenshot_15.png)

Вывод команды **show spanning-tree** на всех трех коммутаторах:

![](https://github.com/Art1shock/images/blob/main/%D0%A1%D0%BA%D1%80%D0%B8%D0%BD%D1%8B%20%D0%B4%D0%BB%D1%8F%20%D0%94%D0%97_7/Screenshot_16.png)

#### Какой порт выбран протоколом STP в качестве порта корневого моста на каждом коммутаторе некорневого моста? 

В качестве порта корневого моста были выбраны порты на коммутаторах S1 (Fa0/1) и S3 (Fa0/1)

#### Почему протокол STP выбрал эти порты в качестве портов корневого моста на этих коммутаторах?

Эти два порта были выбраны по двум причинам:

1) У них наименьшая стоимость пути до корневого моста. При таком условии можно было бы выбрать, например, на коммутаторе S1 вместо порта Fa0/1 порт Fa0/2, так как стоимости пути у них одинаковые, но здесь уже появляется второй пункт.

2) Выбирается порт с наименьшим номером.

[ВЕРНУТЬСЯ НАВЕРХ СТРАНИЦЫ](https://github.com/Art1shock/otus-networks/tree/main/labs/lab06)
